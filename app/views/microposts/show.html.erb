<%= render layout: 'layouts/forum_layout' do %>
<div class="row">
  <div class="col-xs-12 col-md-8">
    <div class="main-list">
      <div class="cont-forum view">
        <div class="row">
          <div class="col-xs-3 col-sm-2">
            <div class="avatar">
              <%= image_tag @micropost.user.avatar.thumb.url, alt: "Immagine del profilo", class: "img-circle" %>
              <p><%= link_to @micropost.user.username, @micropost.user %></p>
            </div>
          </div>
          <div class="col-xs-9 col-sm-10 post-text">
              <h4>
                <%= @micropost.title %>
                <% if current_user && current_user == @micropost.user %>
                  <%= link_to edit_micropost_path(@micropost) do %>
                    <span class="glyphicon glyphicon-cog pull-right"></span>
                  <% end %>
                <% end %>
              </h4>
              <p>
                <%= @micropost.content %>
              </p>
          </div>
          <div class="col-xs-12">
	     <div class="border-top view-info">
		<div class="col-xs-4">
		  <span class="glyphicon glyphicon-time"></span><%= time_ago_in_words(@micropost.created_at) %>
		</div>
		<div class="pull-right col-xs-1">
		  <% if current_user && @micropost.has_attachment? %>
		    <%= link_to @micropost.attachment.url, download: "micropost_#{@micropost.id}_attachment" do %>
    		  <span class="glyphicon glyphicon-download"></span>
		    <% end %>
		  <% else %>
          <span class="glyphicon glyphicon-download disable"></span>
		  <% end %>
		</div>
		<div class="pull-right col-xs-1">
		  <% if current_user && @micropost.has_attachment? %>
    		  <span class="glyphicon glyphicon-eye-open"></span>
		  <% else %>
          <span class="glyphicon glyphicon-eye-open disable"></span>
		  <% end %>
		</div>
		<div class="pull-right col-xs-1">
		  <a href="#comment_content" style="color:black"><span class="glyphicon glyphicon-comment"></span></a>
		</div>
		<div class="pull-right col-xs-3">
		  <div class="pull-right">

        <% if current_user && current_user != @micropost.user %>
    		  <% if current_user.following?(@micropost) %>
        		<%= @micropost.followers_count %>                          
            <%= link_to micropost_follow_path(id: @micropost.id), method: 'delete' do %>
              <span class="glyphicon glyphicon-thumbs-up " data-container="body" data-toggle="popover"
    	                                  data-trigger="hover" data-content="Non mi piace"
    	                                  data-placement="top">
              </span>
            <% end %>
    		  <% else %>
            <%= @micropost.followers_count %>                          
            <%= link_to new_micropost_follow_path(id: @micropost.id) do %>
              <span class="glyphicon glyphicon-thumbs-up " data-container="body" data-toggle="popover"
    	                                  data-trigger="hover" data-content="Mi piace"
    	                                  data-placement="top">
    	        </span>
            <% end %>
          <% end %>
        <% else %>
          <%= @micropost.followers_count %>
          <span class="glyphicon glyphicon-thumbs-up disable"></span>
        <% end %>
      </div>
		</div>
	      </div>
          </div>
        </div>
       </div>
       <% if current_user %>
         <h4>Lascia un commento</h4>
         <div class="cont-forum comment-area">
           <div class="row">
             <div class="col-xs-3 col-sm-2">
               <div class="avatar">
                 <%= image_tag @micropost.user.avatar.thumb.url, alt: "Immagine del profilo", class: "img-circle" %>
                 <p><%= link_to @micropost.user.username, @micropost.user %></p>
               </div>
             </div>
             <div class="col-xs-9 col-sm-10">
                 <%= form_for [@micropost, @comment] do |f| %>
                   <%= render 'layouts/error_messages', object: f.object %>
                   <%= f.text_area :content, placeholder: "Scrivi un commento...", class: 'form-control' %>
                   <%= f.submit "Invia commento", class:'btn btn-primary pull-right' %>
                 <% end %>
             </div>
           </div>
         </div>
       <% end %>
       <h4>Lista commenti</h4>
       <div class="comment-container">
        <ul class="comments-list">
           <%= render @micropost.comments %>
        </ul>
       </div> 
     </div>
   </div>
   <%= render 'layouts/forum_sidebox' %>
<% end %>
